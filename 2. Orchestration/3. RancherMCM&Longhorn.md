Rancher Demo 02 - 04 -2025
nginx reverse proxy

##### Rancher Kubernetes Engine 2 (RKE2)
Easily comply with DISA STIGS

Install with Docker and Kubernetes

##### Rancher Desktop
local Kubernetes environment
container management 
provides software out of the box
able to choose version of Kubernetes


In order to install Rancher MCM using Helm, the Rancher Helm repo must be added to the local environment.
```
helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
```

Run the following command to create the Rancher namespace. The namespace is where the Rancher MCM components will be deployed, and must be created before the Helm install.
```
kubectl create namespace cattle-system
```

Create a secret containing a self-signed certificate and key pair. This secret will be used to secure the Rancher MCM UI.
```
kubectl -n cattle-system create secret tls tls-rancher-ingress --cert=/ab/certs/tls.chain --key=/ab/certs/tls.key
```

The following command will install Rancher MCM using Helm.
```
helm upgrade --install rancher rancher-stable/rancher \
--namespace cattle-system \
--version 2.9.2 \
--set hostname=$(cat /ab/hostname) \
--set ingress.tls.source=secret \
--set replicas=1 \
--set bootstrapPassword=ybspTTbqy#wMRq24gZc^Je9up7YFweW%CZr@#
```
		
###### What's Happening Here?
The above command is performing the following actions:
1. Installing Rancher MCM using the Rancher Helm repo.
2. Installing Rancher MCM in the **cattle-system** namespace.
3. Requesting the Rancher MCM version to known stable version **2.9.2**.
4. Setting the hostname based on the contents of the **/ab/hostname** file. This file was created during the lab environment setup and contains the hostname of the lab server.
5. Setting the TLS source to **secret**, which references the TLS secret created in the previous step.
6. Setting the bootstrap password to **ybspTTbqy#wMRq24gZc^Je9up7YFweW%CZr@#**

Using Kubectl, verify that Rancher MCM is running by running the following command:
```
kubectl -n cattle-system rollout status deployment/rancher
```
OR
```
kubectl -n cattle-system get deploy rancher
```
In addition to verifying the deployment via **kubectl**, it's also possible to verify Rancher MCM is running by visiting the Rancher MCM UI.

First, get the name of the hostname of the server you are using by running the following command:
```
getUrl https
```

1. Copy this URL from the terminal.
2. Open a web browser and paste the URL into the address bar.
3. When asked to enter the **admin** password, use the password **ybspTTbqy#wMRq24gZc^Je9up7YFweW%CZr@#**
4. Confirm the server URL and accept the End User License Agreement (EULA).

Once the EULA is accepted, the Rancher MCM UI will be displayed. This is the main interface for managing and monitoring the Kubernetes clusters that are part of the Rancher MCM deployment.

In this section, Longhorn will be deployed via the Rancher MCM UI. While it is possible to install Longhorn via the command line, the Rancher MCM UI provides a simple and easy-to-use interface for deploying the service on a Kubernetes cluster.

Note: Longhorn has specific requirements which must be met in order for it to deploy successfully. Please visit the [Longhorn installation requirements](https://longhorn.io/docs/1.7.2/deploy/install/#installation-requirements) for more information. Failure to meet these requirements may result in a failed deployment.

Deploy Longhorn via the Rancher MCM UI by following the steps below:
1. In Rancher MCM, click on the burger menu in the top left corner of the screen.
2. Select **local** from the **Home** section of the menu.
3. Once in the **local** environment, click on **Apps** and **Charts** in the left side menu.
4. Find the Longhorn app and click on the **Install** button.
5. Add a check to the **Customize Helm Options Before Install** option and click **Next**.
6. On the **Edit Options** page, click on **Longhorn Storage Class Options**.
7. Change the **Default Storage Class Replica Count** to **1** then click **Next** in the lower right corner.
8. Click **Install** to complete the Longhorn installation.
9. A terminal window will appear on the bottom showing the progress of the installation.
10. After a few moments, a message **SUCCESS** message will appear.
11. Longhorn is now installed and ready for use.

###### Why are we installing Longhorn?

Longhorn is an open source container storage orchestration system that runs on Kubernetes. It provides persistent storage to containers running in a Kubernetes cluster. We will use Longhorn for persistent storage of the data generated by Neuvector.
